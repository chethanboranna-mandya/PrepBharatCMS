<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Tutorial JSON Builder</title>
  <link rel="stylesheet" href="styles.css"/>
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
<div class="main-horizontal">
  <div class="left-panel">
    <input type="file" id="jsonFileInput" accept=".json"/>
    <button onclick="loadFromFile()">üìÇ Load JSON</button>
    <button onclick="openRawContentLoader()">üìÑ Load Raw Content</button>
    <h2>Tutorial JSON Builder</h2>
    <div class="row">
      <div class="field"><label>State:</label>
        <select id="stateSelect"><option value="">Select State</option></select></div>

      <div class="field"><label>Board:</label>
        <select id="boardSelect"><option value="">Select Board</option></select></div>
      <div class="field"><label>Conducted By:</label>
        <input type="text" id="conductedBy" readonly />
      </div>

      <div class="field"><label>Year:</label><select id="yearSelect"></select></div>

      <div class="field"><label>Subject:</label>
        <select id="subjectSelect"><option value="">Select Subject</option></select></div>

      <div class="field"><label>Tutorial ID:</label>
        <input type="text" id="tutorialId" readonly/></div>
    </div>
    <label>Tutorial Title:</label><input type="text" id="tutorialTitle"/>
    <label>Authority Exam ID:</label><input type="text" id="authorityExamId"/>
    <div class="container">
      <div class="question-sidebar">
        <div class="question-list" id="questionList"></div>
        <div class="sidebar-buttons">
          <button onclick="addQuestion()">‚ûï Add</button>
          <button onclick="removeQuestion()">‚ûñ Remove</button>
        </div>
      </div>
      <div class="editor-panel"><div id="questionEditor"></div></div>
    </div>
  </div>

  <div class="right-panel">
    <div class="json-header">
      <h3>Generated JSON</h3>
      <button onclick="generateJSON()">üßæ Generate JSON</button>
      <button id="previewButton">üëÅÔ∏è Preview</button>
    </div>
    <div class="resizable-wrapper">
      <!-- JSON Output -->
      <pre id="output" class="json-box" contenteditable="true"></pre>



    </div>
  </div>

</div>

<script src="config.js"></script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import {
    getStorage,
    ref,
    uploadBytesResumable,
    getDownloadURL,
    deleteObject // ‚úÖ include deleteObject here
  } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";


  const firebaseConfig = {
    apiKey: "AIzaSyDkRSU7sVKQXmQo4C-imX0aSeHXHhlH59E",
    authDomain: "prepbharat.firebaseapp.com",
    projectId: "prepbharat",
    storageBucket: "prepbharat.firebasestorage.app",
    messagingSenderId: "593555148862",
    appId: "1:593555148862:web:d627edfe32a17c71a5c16f",
    measurementId: "G-7QGE8KDDTF"
  };
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);

  // ‚úÖ Make firebase functions available globally
  window.firebaseStorage = {
    storage,
    ref,
    deleteObject,
    uploadBytesResumable,
    getDownloadURL
  };

  // This is modular version of uploadImageToFirebase
  window.uploadImageToFirebase = function(file, subject, year, index, suffix, onProgress) {
    return new Promise((resolve, reject) => {
      const fileName = `${subject.toLowerCase()}_${year}_${index + 1}${suffix}`;
      const storageRef = ref(storage, `questions/${subject}/${year}/${fileName}`);
      const uploadTask = uploadBytesResumable(storageRef, file);

      uploadTask.on(
              "state_changed",
              (snapshot) => {
                const percent = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                if (onProgress) onProgress(Math.round(percent));
              },
              (error) => reject(error),
              () => {
                getDownloadURL(uploadTask.snapshot.ref).then(resolve).catch(reject);
              }
      );
    });
  };
</script>

<script src="script.js"></script>

<script>
  const previewPanel = document.getElementById("previewPanel");
  const previewContent = document.getElementById("previewContent");
  const closeBtn = document.getElementById("closePreview");

  closeBtn.addEventListener("click", () => {
    previewPanel.classList.remove("open");
  });

  // Optional rebind if using inline onclick
  document.querySelector('button[onclick="previewJSON()"]').onclick = previewJSON;
</script>


<!-- Slide-in Preview Panel -->
<div class="slide-panel" id="previewPanel">
  <div class="panel-header">
    <h3 id="previewTitle">Preview</h3>
    <button class="close-btn" id="closePreview">‚úñ</button>
  </div>

  <div class="panel-content" id="previewContent">
    <!-- Your preview HTML will go here -->
  </div>
</div>

<!-- Popover Window (Modal) for Raw Paste -->
<div id="rawContentModal" style="display:none; position:fixed; top:10%; left:10%; width:80%; background:#fff; border:1px solid #ccc; padding:20px; z-index:1000;">
  <h3>Paste Raw Questions</h3>
  <textarea id="rawContentInput" style="width:100%; height:300px;"></textarea>
  <div style="margin-top:10px;">
    <button onclick="parseRawContent()">Parse</button>
    <button onclick="closeRawContentLoader()">Cancel</button>
  </div>
</div>
</body>
</html>

